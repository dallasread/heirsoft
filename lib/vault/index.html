{{#if vault}}
    <sidebar>
        <ul>
            {{>branch branch=vault vault=vault selected=selected}}
        </ul>

        {{#if vault.isWritable}}
            <hr>

            <form name="encrypt">
                <button>Download</button>
            </form>

            <hr>

            <form name="decrypt">
                <input type="text" placeholder="Private Key">
                <textarea placeholder="Content"></textarea><br>
                <button type="submit">Restore</button>
            </form>
        {{/if}}
    </sidebar>

    <main>
        {{#with selected=selected vault=vault}}
            {{#if selected}}
                <div class="branch" branch:{{selected}}>
                    {{#if selected.parent && vault.isWritable}}
                        <a href="#" class="delete-child" data-delete-branch branch:{{selected}}>Delete</a>
                    {{/if}}

                    <input type="text" data-branch-attr="path" value::{{selected.path}} disabled::{{!vault.isWritable}}>

                    {{#if vault.isWritable && vault === selected}}
                        <p>
                            Everybody gets two passwords
                        </p>

                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Public</th>
                                    <th>Private</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                {{#each selected.keys}}
                                    <tr class="key" key:{{this}}>
                                        <td>
                                            <input type="text" value::{{name}} data-key-attr="name">
                                        </td>
                                        <td>
                                            <input type="text" value::{{public}} data-key-attr="public">
                                        </td>
                                        <td>
                                            <input type="text" value::{{private}} data-key-attr="private">
                                        </td>
                                        <td>
                                            <a href="#" data-delete-key>x</a>
                                        </td>
                                    </tr>
                                {{/each}}

                                <tr>
                                    <td>
                                        <a href="#" data-add-key>+ Add</a>
                                    </td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                    {{else}}
                        {{#if vault.isWritable}}
                            <ul class="branch-keys">
                                {{#each selected.parent.permissions permissions=selected.permissions}}
                                    <li class="key" key:{{this}}>
                                        <label>
                                            {{#if @includes(permissions, this)}}
                                                <span></span>
                                                <input type="checkbox" checked>
                                            {{else}}
                                                <input type="checkbox">
                                            {{/if}}
                                            {{name}}
                                        </label>
                                    </li>
                                {{/each}}
                            </ul>
                        {{/if}}

                        {{#if selected.children}}
                            <ul>
                                {{>branch branch=selected}}
                            </ul>
                        {{else}}
                            <textarea data-branch-attr="content" value::{{selected.content}} disabled::{{!vault.isWritable}}></textarea>
                        {{/if}}
                    {{/if}}
                </div>
            {{/if}}
        {{/with}}
    </main>
{{/if}}
